<!-- contents.ejs -->
<!-- Summernote CSS -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

<style>
    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ ê°œì„  */
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem; /* ê¸€ì”¨ í¬ê¸° ì‘ê²Œ ì¡°ì • */
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* í…Œì´ë¸”ì— ê·¸ë¦¼ì ì¶”ê°€ */
        border-radius: 8px;
        overflow: hidden; /* ëª¨ì„œë¦¬ ë¼ìš´ë”©ì„ ìœ„í•´ */
    }
    th, td {
        border: 0.1px solid #e0e4e8; /* ë” ë¶€ë“œëŸ¬ìš´ ë³´ë” ìƒ‰ìƒ */
        padding: 6px 10px; /* íŒ¨ë”© ì¤„ì—¬ì„œ í–‰ ë†’ì´ ê°ì†Œ */
        text-align: left;
    }
    th {
        background: linear-gradient(90deg, #a7a8a8 0%, #585b5e 100%); /* ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ */
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    td {
        background-color: #ffffff;
        color: #333;
        transition: background-color 0.3s ease; /* í˜¸ë²„ íš¨ê³¼ë¥¼ ìœ„í•œ ì „í™˜ */
    }
    tr:nth-child(even) td {
        background-color: #f8f9fa; /* ì§ìˆ˜ í–‰ì— ì—°í•œ ë°°ê²½ìƒ‰ */
    }
    tr:hover td {
        background-color: #e9ecef; /* í˜¸ë²„ ì‹œ ë°°ê²½ìƒ‰ ë³€ê²½ */
    }

    /* ë§í¬ ìŠ¤íƒ€ì¼ ê°œì„  */
    .content-link {
        color: #007bff; /* ê¸°ë³¸ ë§í¬ ìƒ‰ìƒ */
        text-decoration: none; /* ë°‘ì¤„ ì œê±° */
        position: relative; /* ë°‘ì¤„ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ */
        transition: color 0.3s ease; /* ìƒ‰ìƒ ì „í™˜ ë¶€ë“œëŸ½ê²Œ */
    }
    .content-link:hover {
        color: #0056b3; /* í˜¸ë²„ ì‹œ ìƒ‰ìƒ ë³€ê²½ */
    }
    .content-link::after {
        content: '';
        position: absolute;
        width: 0;
        height: 1px;
        bottom: -2px;
        left: 0;
        background-color: #0056b3; /* í˜¸ë²„ ì‹œ ë°‘ì¤„ ìƒ‰ìƒ */
        transition: width 0.3s ease; /* ë°‘ì¤„ ì• ë‹ˆë©”ì´ì…˜ */
    }
    .content-link:hover::after {
        width: 100%; /* í˜¸ë²„ ì‹œ ë°‘ì¤„ì´ ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ í™•ì¥ */
    }

    /* í…Œì´ë¸” ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
    #contentsTable_wrapper {
        max-height: 600px; /* í…Œì´ë¸” ë†’ì´ ê³ ì • (20ê°œ í•­ëª©ì´ ë³´ì´ë„ë¡) */
        overflow: hidden; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ ì œê±° */
    }

    /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° (ë¸Œë¼ìš°ì €ë³„) */
    .dataTables_paginate::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Edge */
    }
    .dataTables_paginate {
        -ms-overflow-style: none; /* IE, Edge */
        scrollbar-width: none; /* Firefox */
    }

    /* DataTables ì •ë³´ ìŠ¤íƒ€ì¼ */
    .dataTables_info {
        font-size: 0.8rem;
        color: #6c757d;
        margin-top: 10px;
    }

    /* íƒ­ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ */
    .tab-content {
        padding: 20px;
    }

    /* íƒ­ ìŠ¤íƒ€ì¼ (Bootstrap ê¸°ë³¸ ìƒ‰ìƒ ìœ ì§€ ë° ë¹„í™œì„± íƒ­ íšŒìƒ‰ ì²˜ë¦¬) */
    .nav-tabs .nav-link {
        border: 1px solid #dee2e6;
        color: #6c757d; /* ë¹„í™œì„± íƒ­ íšŒìƒ‰ */
    }
    .nav-tabs .nav-link.active {
        background-color: #007bff; /* Bootstrap ê¸°ë³¸ íŒŒë€ìƒ‰ */
        color: white;
        border-color: #007bff;
    }
    .nav-tabs .nav-link:hover:not(.active) {
        background-color: #e9ecef; /* í˜¸ë²„ ì‹œ ì•½ê°„ ë°ì€ íšŒìƒ‰ */
        color: #495057;
    }

    /* íƒ­ ê°„ ê°„ê²© */
    .nav-tabs .nav-item {
        margin-right: 10px; /* íƒ­ ê°„ ê°„ê²© */
    }

    /* ê²€ìƒ‰ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    #searchSectionWrapper {
        border: 1px solid #dee2e6; /* íšŒìƒ‰ ë³´ë” */
        border-radius: 10px; /* ë¼ìš´ë”© */
        margin-bottom: 20px;
    }
    #searchSection {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 0;
        display: none; /* ì´ˆê¸°ì—ëŠ” ì ‘íŒ ìƒíƒœ */
    }
    #searchToggleBtn {
        width: 100%;
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1rem;
    }
    #searchToggleBtn:hover {
        background: #0056b3;
    }
    .search-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
    }
    .search-row input, .search-row select {
        flex: 1;
        padding: 6px 10px;
        border-radius: 5px;
        border: 1px solid #ced4da;
    }

    /* í¼ ìŠ¤íƒ€ì¼ */
    #contentForm {
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        padding: 30px;
        width: 100%; /* í™”ë©´ 100% ë„ˆë¹„ */
    }

    /* í¼ ë¼ë²¨ê³¼ ì…ë ¥ë€ ìŠ¤íƒ€ì¼ */
    .form-row {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
        font-size: 0.85rem;
    }
    .form-row label {
        width: 100px;
        margin-right: 5px;
        color: #333;
        font-weight: 600;
    }
    .form-control {
        flex: 1;
        border-radius: 8px;
        border: 1px solid #ced4da;
        padding: 6px 10px;
        font-size: 0.85rem;
        transition: border-color 0.3s;
    }
    .form-control:focus {
        border-color: #6c63ff;
        box-shadow: 0 0 5px rgba(108, 99, 255, 0.3);
    }

    /* Summernote ìŠ¤íƒ€ì¼ */
    #summernote {
        flex: 1;
    }
    .note-editor {
        border-radius: 8px;
        border: 1px solid #ced4da;
    }

    /* í•œ ì¤„ì— ì„¸ ê°œ í•„ë“œ ë°°ì¹˜ */
    .form-row-triple {
        display: flex;
        gap: 15px;
        margin-bottom: 12px;
    }
    .form-row-triple > div {
        flex: 1;
        display: flex;
        align-items: center;
    }
    .form-row-triple label {
        width: 100px;
        margin-right: 5px;
        font-size: 0.85rem;
        color: #333;
        font-weight: 600;
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn-primary, .btn-danger, .btn-new {
        padding: 8px 20px;
        border-radius: 25px;
        font-size: 0.9rem;
        transition: transform 0.2s, background-color 0.3s;
    }
    .btn-primary {
        background: linear-gradient(90deg, #6c63ff 0%, #4e46e5 100%);
        border: none;
    }
    .btn-primary:hover {
        background: linear-gradient(90deg, #4e46e5 0%, #6c63ff 100%);
        transform: translateY(-2px);
    }
    .btn-danger {
        background: linear-gradient(90deg, #ff6b6b 0%, #ee5253 100%);
        border: none;
    }
    .btn-danger:hover {
        background: linear-gradient(90deg, #ee5253 0%, #ff6b6b 100%);
        transform: translateY(-2px);
    }
    .btn-new {
        background: linear-gradient(90deg, #28a745 0%, #218838 100%); /* ì´ˆë¡ìƒ‰ ê³„ì—´ */
        border: none;
        margin-right: 10px;
    }
    .btn-new:hover {
        background: linear-gradient(90deg, #218838 0%, #28a745 100%);
        transform: translateY(-2px);
    }
</style>

<main class="content">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="container custom-container">
                <div class="container-fluid mt-3">
                    <!-- ê²€ìƒ‰ ì˜ì—­ (íƒ­ ìœ„ë¡œ ì´ë™) -->
                    <div id="searchSectionWrapper">
                        <button id="searchToggleBtn">
                            <span><i class="fas fa-search"></i> Search</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div id="searchSection">
                            <div class="search-row">
                                <input type="text" id="integratedSearch" placeholder="í†µí•© ê²€ìƒ‰ (Title, Note1, Note2, Note3, Memo1, Memo2)">
                            </div>
                            <div class="search-row">
                                <select id="searchGubun">
                                    <option value="">Gubun ì„ íƒ</option>
                                    <% gubunCodes.forEach(gc => { %>
                                        <option value="<%= gc.code_value %>"><%= gc.code_name %></option>
                                    <% }); %>
                                </select>
                                <select id="searchStatus">
                                    <option value="">Status ì„ íƒ</option>
                                    <% statusCodes.forEach(sc => { %>
                                        <option value="<%= sc.code_value %>"><%= sc.code_name %></option>
                                    <% }); %>
                                </select>
                                <input type="text" id="searchCreateUser" placeholder="Create User">
                                <input type="text" id="searchAssignee" placeholder="Assignee">
                            </div>
                            <button id="searchBtn" class="btn btn-primary">ê²€ìƒ‰</button>
                        </div>
                    </div>

                    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                    <ul class="nav nav-tabs" id="contentTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="list-tab" data-bs-toggle="tab" data-bs-target="#list" type="button" role="tab">ë¦¬ìŠ¤íŠ¸</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="add-tab" data-bs-toggle="tab" data-bs-target="#add" type="button" role="tab">ì¶”ê°€</button>
                        </li>
                    </ul>

                    <!-- íƒ­ ì½˜í…ì¸  -->
                    <div class="tab-content" id="contentTabContent">
                        <!-- ë¦¬ìŠ¤íŠ¸ íƒ­ -->
                        <div class="tab-pane fade show active" id="list" role="tabpanel">
                            <!-- ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
                            <table id="contentsTable">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Gubun</th>
                                        <th>Status</th>
                                        <th>Create User</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>

                        <!-- ì¶”ê°€ íƒ­ -->
                        <div class="tab-pane fade" id="add" role="tabpanel">
                            <form id="contentForm" class="p-4">
                                <input type="hidden" id="editId">
                                <div class="form-row">
                                    <label for="editTitle">Title</label>
                                    <input type="text" class="form-control" id="editTitle">
                                </div>
                                <div class="form-row">
                                    <label for="editGubun">Gubun</label>
                                    <select class="form-control" id="editGubun">
                                        <option value="">ì„ íƒ</option>
                                        <% gubunCodes.forEach(gc => { %>
                                            <option value="<%= gc.code_value %>"><%= gc.code_name %></option>
                                        <% }); %>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label for="editNote1">Note1</label>
                                    <div id="summernote"></div>
                                </div>
                                <div class="form-row">
                                    <label for="editNote2">Note2</label>
                                    <textarea class="form-control" id="editNote2"></textarea>
                                </div>
                                <div class="form-row">
                                    <label for="editNote3">Note3</label>
                                    <textarea class="form-control" id="editNote3"></textarea>
                                </div>
                                <!-- Status, Create User, Assignee í•œ ì¤„ -->
                                <div class="form-row-triple">
                                    <div>
                                        <label for="editStatus">Status</label>
                                        <select class="form-control" id="editStatus">
                                            <option value="">ì„ íƒ</option>
                                            <% statusCodes.forEach(sc => { %>
                                                <option value="<%= sc.code_value %>"><%= sc.code_name %></option>
                                            <% }); %>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="editCreateUser">Create User</label>
                                        <input type="text" class="form-control" id="editCreateUser" readonly>
                                        <input type="hidden" id="editCreateUserId">
                                    </div>
                                    <div>
                                        <label for="editAssignee">Assignee</label>
                                        <input type="text" class="form-control" id="editAssignee" readonly data-bs-toggle="modal" data-bs-target="#userSearchModal">
                                        <input type="hidden" id="editAssigneeId">
                                    </div>
                                </div>
                                <!-- Start Date, End Date, Plan Date í•œ ì¤„ -->
                                <div class="form-row-triple">
                                    <div>
                                        <label for="editStartDate">Start Date</label>
                                        <input type="text" class="form-control" id="editStartDate">
                                    </div>
                                    <div>
                                        <label for="editEndDate">End Date</label>
                                        <input type="text" class="form-control" id="editEndDate">
                                    </div>
                                    <div>
                                        <label for="editPlanDate">Plan Date</label>
                                        <input type="text" class="form-control" id="editPlanDate">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label for="editMemo1">Memo1</label>
                                    <input type="text" class="form-control" id="editMemo1">
                                </div>
                                <div class="form-row">
                                    <label for="editMemo2">Memo2</label>
                                    <input type="text" class="form-control" id="editMemo2">
                                </div>
                                <div class="text-center mt-4">
                                    <button type="button" id="newContent" class="btn btn-new me-2">ì‹ ê·œ ìƒì„±</button>
                                    <button type="button" id="saveContent" class="btn btn-primary me-2">ì €ì¥</button>
                                    <button type="button" id="deleteContent" class="btn btn-danger">ì‚­ì œ</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>


<!-- ì‚¬ìš©ì ê²€ìƒ‰ ëª¨ë‹¬ -->
<div class="modal fade" id="userSearchModal" tabindex="-1" aria-labelledby="userSearchModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userSearchModalLabel">ë‹´ë‹¹ì ì„ íƒ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="userSearchInput" class="form-label">ì‚¬ìš©ì ì´ë¦„ ê²€ìƒ‰</label>
                    <input type="text" class="form-control" id="userSearchInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    <button class="btn btn-primary" id="userSearchButton">ê²€ìƒ‰</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="userSearchTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ì´ë¦„</th>
                                <th>ì´ë©”ì¼</th>
                            </tr>
                        </thead>
                        <tbody id="userSearchResults">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
<!-- DataTables JS (after jQuery) -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
    $(document).ready(function () {
        const statusCodes = '<%- JSON.stringify(statusCodes) %>';
        const gubunCodes = '<%- JSON.stringify(gubunCodes) %>';
        const currentUser = {
            id: '<%- user.id %>',
            user_name: '<%- user.user_name %>'
        };
        let dataTable;

        // Summernote ì´ˆê¸°í™”
        $('#summernote').summernote({
            height: 200,
            placeholder: 'ì—¬ê¸°ì— ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”'
        });

        // Create User í•„ë“œì— í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì„¤ì •
        $('#editCreateUser').val(currentUser.user_name);
        $('#editCreateUserId').val(currentUser.id);


        // ê²€ìƒ‰ ì˜ì—­ í† ê¸€ ë° ì•„ì´ì½˜ ë³€ê²½
        $('#searchToggleBtn').click(function (event) {
            event.preventDefault(); // âœ… ê¸°ë³¸ ë™ì‘ ë°©ì§€
            event.stopPropagation(); // âœ… ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€

            $('#searchSection').slideToggle();

            const icon = $(this).find('.fa-chevron-down, .fa-chevron-up');
            icon.toggleClass('fa-chevron-down fa-chevron-up');
        });

       //ì‚¬ìš©ì ê²€ìƒ‰
        // $('#userSearchInput').on('input', function () {
        $('#userSearchButton').on('click', function () {
            const searchTerm = $('#userSearchInput').val().trim();
            if (!searchTerm) {
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
 
            $.get(`/user/search/${encodeURIComponent(searchTerm)}`, function (data) {

                console.log('ğŸ“Œ ê²€ìƒ‰ ê²°ê³¼:', data); // âœ… ì‘ë‹µ ë°ì´í„° í™•ì¸

                const users = data || [];
                const tbody = $('#userSearchResults');
                tbody.empty();

                users.forEach(user => {

                    console.log('ğŸ“Œ ê°œë³„ ì‚¬ìš©ì:', user); // âœ… ê°œë³„ ê°ì²´ í™•ì¸

                    
                    const row = `
                        <tr class="user-row" data-id="${user.id}" data-name="${user.user_name}">
                            <td>${user.id}</td>
                            <td>${user.user_name}</td>
                            <td>${user.email}</td>
                        </tr>
                    `;
                    tbody.append(row);
                });
            }).fail(function (xhr, status, error) {
                console.error('Error searching users:', error);
                alert('ì‚¬ìš©ì ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        });

        // ì‚¬ìš©ì ì„ íƒ
        $(document).on('click', '.user-row', function () {
            const userId = $(this).data('id');
            const userName = $(this).data('name');
            $('#editAssigneeId').val(userId);
            $('#editAssignee').val(userName);
            $('#userSearchModal').modal('hide');
        });


        // DataTable ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë“œ
        function initializeDataTable(data) {
            if (dataTable) {
                dataTable.destroy(); // ê¸°ì¡´ í…Œì´ë¸” ì œê±°
            }

            dataTable = $('#contentsTable').DataTable({
                data: data,
                columns: [
                    { data: 'title', render: function (data, type, row) {
                        return `<a href="#" class="content-link" data-id="${row.id}">${data || ''}</a>`;
                    }},
                    { data: 'gubun', defaultContent: '' },
                    { data: 'status', defaultContent: '' },
                    { data: 'create_user', defaultContent: '' },
                ],
                pageLength: 10, // í˜ì´ì§€ë‹¹ 10ê°œ í•­ëª©
                lengthChange: false, // í•­ëª© ìˆ˜ ì„ íƒ ë¹„í™œì„±í™”
                searching: false, // DataTables ê¸°ë³¸ ê²€ìƒ‰ ë¹„í™œì„±í™” (ì»¤ìŠ¤í…€ ê²€ìƒ‰ ì‚¬ìš©)
                ordering: true, // ì •ë ¬ í™œì„±í™”
                info: true, // ì •ë³´ í‘œì‹œ
                paging: true, // í˜ì´ì§• í™œì„±í™”
                language: {
                    paginate: {
                        previous: 'ì´ì „',
                        next: 'ë‹¤ìŒ'
                    },
                    info: 'ì´ _TOTAL_ê°œ ì¤‘ _START_ - _END_ í‘œì‹œ'
                }
            });
        }

        // ë°ì´í„° ë¡œë“œ ë° í•„í„°ë§
        function loadContents() {
            const integratedSearch = $('#integratedSearch').val().toLowerCase();
            const searchGubun = $('#searchGubun').val();
            const searchStatus = $('#searchStatus').val();
            const searchCreateUser = $('#searchCreateUser').val().toLowerCase();
            const searchAssignee = $('#searchAssignee').val().toLowerCase();

            $.get('/contents/data', function (data) {
                let allData = data || []; // ë°ì´í„°ê°€ nullì¼ ê²½ìš° ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”

                // í•„í„°ë§
                let filteredData = allData.filter(content => {
                    const matchesIntegrated = !integratedSearch || 
                        (content.title?.toLowerCase().includes(integratedSearch) ||
                         content.note1?.toLowerCase().includes(integratedSearch) ||
                         content.note2?.toLowerCase().includes(integratedSearch) ||
                         content.note3?.toLowerCase().includes(integratedSearch) ||
                         content.memo1?.toLowerCase().includes(integratedSearch) ||
                         content.memo2?.toLowerCase().includes(integratedSearch));
                    const matchesGubun = !searchGubun || content.gubun === searchGubun;
                    const matchesStatus = !searchStatus || content.status === searchStatus;
                    const matchesCreateUser = !searchCreateUser || content.create_user?.toLowerCase().includes(searchCreateUser);
                    const matchesAssignee = !searchAssignee || content.assignee?.toLowerCase().includes(searchAssignee);

                    return matchesIntegrated && matchesGubun && matchesStatus && matchesCreateUser && matchesAssignee;
                });

                // DataTable ì´ˆê¸°í™” ë° ë°ì´í„° ì ìš©
                initializeDataTable(filteredData);
            }).fail(function (xhr, status, error) {
                console.error('Error loading contents:', error);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ì´ˆê¸° ë¡œë“œ
        loadContents();

        // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­
        $('#searchBtn').click(function () {
            loadContents(); // ê²€ìƒ‰ ì‹œ í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
        });

        // í¸ì§‘ ë²„íŠ¼ ë° Title ë§í¬ í´ë¦­ (ì¶”ê°€ íƒ­ìœ¼ë¡œ ì „í™˜)
        $(document).on('click', '.edit-row, .content-link', function (e) {
            e.preventDefault(); // ë§í¬ ê¸°ë³¸ ë™ì‘ ë°©ì§€
            const id = $(this).data('id');
            if (!id || id === 'undefined') {
                console.error('Invalid content ID:', id);
                alert('ìœ íš¨í•˜ì§€ ì•Šì€ ì½˜í…ì¸  IDì…ë‹ˆë‹¤.');
                return;
            }
            $.get(`/contents/data?id=${id}`, function (data) {
                const content = data;
                if (content && content.id == id) {
                    $('#editId').val(content.id);
                    $('#editTitle').val(content.title || '');
                    $('#editGubun').val(content.gubun || '');
                    $('#summernote').summernote('code', content.note1 || '');
                    $('#editNote2').val(content.note2 || '');
                    $('#editNote3').val(content.note3 || '');
                    $('#editStatus').val(content.status || '');
                    $('#editCreateUser').val(content.create_user || '');
                    $('#editCreateUserId').val(content.create_user_id || '');
                    $('#editAssignee').val(content.assignee || '');
                    $('#editAssigneeId').val(content.assignee_id || '');
                    $('#editStartDate').val(content.start_date || '');
                    $('#editEndDate').val(content.end_date || '');
                    $('#editPlanDate').val(content.plan_date || '');
                    $('#editMemo1').val(content.memo1 || '');
                    $('#editMemo2').val(content.memo2 || '');
                    $('#add-tab').tab('show'); // ì¶”ê°€ íƒ­ìœ¼ë¡œ ì „í™˜
                } else {
                    console.error('Content not found for ID:', id);
                    alert('í•´ë‹¹ ì½˜í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }).fail(function (xhr, status, error) {
                console.error('Error fetching content data:', error);
                alert('ì½˜í…ì¸  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        });

        // ì‹ ê·œ ìƒì„± ë²„íŠ¼ í´ë¦­
        $('#newContent').click(function () {
            const newContent = {
                title: $('#editTitle').val(),
                gubun: $('#editGubun').val(),
                note1: $('#summernote').summernote('code'),
                note2: $('#editNote2').val(),
                note3: $('#editNote3').val(),
                status: $('#editStatus').val(),
                create_user_id: currentUser.id, // ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¨ ì‚¬ìš©ì ID
                create_user: currentUser.user_name, // ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¨ ì‚¬ìš©ì ì´ë¦„
                assignee_id: $('#editAssigneeId').val(),
                assignee: $('#editAssignee').val(),
                start_date: $('#editStartDate').val(),
                end_date: $('#editEndDate').val(),
                plan_date: $('#editPlanDate').val(),
                memo1: $('#editMemo1').val(),
                memo2: $('#editMemo2').val()
            };

            $.ajax({
                url: '/contents/create',
                method: 'POST',
                data: newContent,
                success: function (response) {
                    alert('ì‹ ê·œ ì½˜í…ì¸ ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    $('#editId').val('');
                    loadContents(); // í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
                },
                error: function (xhr, status, error) {
                    console.error('Error creating content:', error);
                    alert('ì½˜í…ì¸  ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            });
        });

        // ì €ì¥ ë²„íŠ¼ í´ë¦­
        $('#saveContent').click(function () {
            const id = $('#editId').val() || null;
            const content = {
                title: $('#editTitle').val(),
                gubun: $('#editGubun').val(),
                note1: $('#summernote').summernote('code'),
                note2: $('#editNote2').val(),
                note3: $('#editNote3').val(),
                status: $('#editStatus').val(),
                create_user_id: $('#editCreateUserId').val(), // ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¨ ì‚¬ìš©ì ID
                create_user: $('#editCreateUser').val(), // ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¨ ì‚¬ìš©ì ì´ë¦„
                assignee_id: $('#editAssigneeId').val(),
                assignee: $('#editAssignee').val(),
                start_date: $('#editStartDate').val(),
                end_date: $('#editEndDate').val(),
                plan_date: $('#editPlanDate').val(),
                memo1: $('#editMemo1').val(),
                memo2: $('#editMemo2').val()
            };
            const url = id ? `/contents/update/${id}` : '/contents/create';
            const method = id ? 'PUT' : 'POST';
            $.ajax({
                url: url,
                method: method,
                data: content,
                success: function () {
                    $('#list-tab').tab('show'); // ë¦¬ìŠ¤íŠ¸ íƒ­ìœ¼ë¡œ ë³µê·€
                    loadContents();
                },
                error: function (xhr, status, error) {
                    console.error('Error saving content:', error);
                }
            });
        });

        // ì‚­ì œ ë²„íŠ¼ í´ë¦­
        $('#deleteContent').click(function () {
            const id = $('#editId').val();
            if (id && confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                $.ajax({
                    url: `/contents/delete/${id}`,
                    method: 'DELETE',
                    success: function () {
                        $('#list-tab').tab('show'); // ë¦¬ìŠ¤íŠ¸ íƒ­ìœ¼ë¡œ ë³µê·€
                        loadContents();
                    },
                    error: function (xhr, status, error) {
                        console.error('Error deleting content:', error);
                    }
                });
            }
        });
    });
</script>